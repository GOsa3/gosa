<?xml version="1.0" encoding="UTF-8"?>
<Objects xmlns="http://www.gonicus.de/Objects">
  <Object>
    <Name>ForemanHostGroup</Name>
    <DisplayName>Deployment Group</DisplayName>
    <Description>The foreman - this group is managed by foreman</Description>
    <Templates>
      <Template>foreman-host-group.json</Template>
    </Templates>
    <Backend>LDAP</Backend>
    <BackendParameters>
      <Backend objectClasses="foremanHostGroup" RDN="cn">LDAP</Backend>
      <Backend member="ForemanHost:foremanGroupId,">ObjectHandler</Backend>
      <Backend type="hostgroups" _uuidAttribute="foremanGroupId" _uuidSourceAttribute="id" setOnCreate="name">Foreman</Backend>
    </BackendParameters>
    <BaseObject>true</BaseObject>
    <Attributes>
      <Attribute>
        <Name>cn</Name>
        <Type>UnicodeString</Type>
        <Description>Common Name</Description>
        <Mandatory>true</Mandatory>
      </Attribute>
      <Attribute>
        <Name>name</Name>
        <Type>UnicodeString</Type>
        <Backend>Foreman</Backend>
        <DependsOn>
          <Attribute>cn</Attribute>
        </DependsOn>
        <InFilter>
          <FilterChain>
            <FilterEntry>
              <Filter>
                <Name>CopyValueTo</Name>
                <Param>cn</Param>
              </Filter>
            </FilterEntry>
          </FilterChain>
        </InFilter>
        <OutFilter>
          <FilterChain>
            <FilterEntry>
              <Filter>
                <Name>CopyValueFrom</Name>
                <Param>cn</Param>
              </Filter>
            </FilterEntry>
          </FilterChain>
        </OutFilter>
      </Attribute>
      <Attribute>
        <Name>foremanGroupId</Name>
        <Description>ID used in foreman to identify the hostGroup</Description>
        <Type>UnicodeString</Type>
        <Mandatory>true</Mandatory>
      </Attribute>
      <Attribute>
        <Name>description</Name>
        <Description>Description</Description>
        <Type>UnicodeString</Type>
      </Attribute>

      <Attribute>
        <Name>parent_id</Name>
        <Description>Parent host group id</Description>
        <Type>String</Type>
        <Values populate="getForemanHostgroups"/>
        <BackendType>Integer</BackendType>
        <Backend>Foreman</Backend>
      </Attribute>

      <Attribute>
        <Name>domain_id</Name>
        <Description>Domain the host should be added to</Description>
        <Type>Integer</Type>
        <Backend>Foreman</Backend>
        <Values populate="getForemanDomains"/>
        <InheritFrom relation="parent_id">getForemanHostgroup</InheritFrom>
      </Attribute>

      <Attribute>
        <Name>operatingsystem_id</Name>
        <Type>Integer</Type>
        <Values populate="getForemanOperatingSystems" refresh-on-update="true"/>
        <Backend>Foreman</Backend>
        <InheritFrom relation="parent_id">getForemanHostgroup</InheritFrom>
      </Attribute>

      <Attribute>
        <Name>architecture_id</Name>
        <Type>Integer</Type>
        <Values populate="getForemanArchitectures" refresh-on-update="true"/>
        <Backend>Foreman</Backend>
        <InheritFrom relation="parent_id">getForemanHostgroup</InheritFrom>
      </Attribute>

      <Attribute>
        <Name>ptable_id</Name>
        <Type>Integer</Type>
        <Values populate="getForemanPartitionTables" refresh-on-update="true"/>
        <InheritFrom relation="parent_id">getForemanHostgroup</InheritFrom>
        <Backend>Foreman</Backend>
      </Attribute>

      <Attribute>
        <Name>medium_id</Name>
        <Type>Integer</Type>
        <Values populate="getForemanMedia" refresh-on-update="true"/>
        <InheritFrom relation="parent_id">getForemanHostgroup</InheritFrom>
        <Backend>Foreman</Backend>
      </Attribute>

      <Attribute>
        <Name>root_pass</Name>
        <Type>UnicodeString</Type>
        <Backend>Foreman</Backend>
        <InheritFrom relation="parent_id">getForemanHostgroup</InheritFrom>
      </Attribute>

      <Attribute>
        <Name>pxe_loader</Name>
        <Type>UnicodeString</Type>
        <Backend>Foreman</Backend>
        <InheritFrom relation="parent_id">getForemanHostgroup</InheritFrom>
        <Values>
          <Value>PXELinux BIOS</Value>
          <Value>PXELinux UEFI</Value>
          <Value>Grub UEFI 64bit</Value>
          <Value>Grub UEFI 32bit</Value>
          <Value>Grub SecureBoot</Value>
          <Value>Grub2 UEFI 64bit</Value>
          <Value>Grub2 UEFI 32bit</Value>
          <Value>Grub2 SecureBoot</Value>
          <Value>None</Value>
        </Values>
      </Attribute>

      <Attribute>
        <Name>member</Name>
        <Description>RFC2256: member of a group</Description>
        <Type>UnicodeString</Type>
        <MultiValue>true</MultiValue>
        <Validators>
          <Condition>
            <Name>ObjectWithPropertyExists</Name>
            <Param>ForemanHost</Param>
            <Param>dn</Param>
          </Condition>
        </Validators>
        <References>
          <Reference>
            <Object>ForemanHost</Object>
            <Attribute>groupMembership</Attribute>
          </Reference>
        </References>
      </Attribute>
      <Attribute>
        <Name>id</Name>
        <Type>String</Type>
        <BackendType>Integer</BackendType>
        <Backend>Foreman</Backend>
        <DependsOn>
          <Attribute>foremanGroupId</Attribute>
        </DependsOn>
        <InFilter>
          <FilterChain>
            <FilterEntry>
              <Filter>
                <Name>CopyValueTo</Name>
                <Param>foremanGroupId</Param>
              </Filter>
            </FilterEntry>
          </FilterChain>
        </InFilter>
      </Attribute>
      <Attribute>
        <Name>businessCategory</Name>
        <Description>RFC2256: business category</Description>
        <Type>UnicodeString</Type>
      </Attribute>
      <Attribute>
        <Name>o</Name>
        <Description>RFC2256: organization this object belongs to</Description>
        <Type>UnicodeString</Type>
      </Attribute>
      <Attribute>
        <Name>owner</Name>
        <Description>RFC2256: owner (of the object)</Description>
        <Type>UnicodeString</Type>
        <MultiValue>true</MultiValue>
        <Mandatory>false</Mandatory>
        <Validators>
          <Condition>
            <Name>ObjectWithPropertyExists</Name>
            <Param>User</Param>
            <Param>dn</Param>
          </Condition>
        </Validators>
      </Attribute>
      <Attribute>
        <Name>ou</Name>
        <Description>RFC2256: organizational unit this object belongs to</Description>
        <Type>UnicodeString</Type>
        <MultiValue>true</MultiValue>
        <Mandatory>false</Mandatory>
      </Attribute>
      <Attribute>
        <Name>seeAlso</Name>
        <Description>RFC4519: DN of related object</Description>
        <Type>UnicodeString</Type>
        <MultiValue>true</MultiValue>
        <Validators>
          <Condition>
            <Name>IsExistingDN</Name>
          </Condition>
        </Validators>
      </Attribute>
    </Attributes>
    <Find>
    <Aspect>
      <Tag>ForemanHostGroup</Tag>
      <Keyword>ForemanGroup</Keyword>
      <Keyword>ForemanMember</Keyword>
      <Keyword>ForemanMembership</Keyword>
      <Search>cn</Search>
      <Search>description</Search>
      <Resolve type="ForemanHost" filter="cn">member</Resolve>
      <Result>
        <Map>
          <Source>cn</Source>
          <Destination>title</Destination>
        </Map>
      </Result>
    </Aspect>
    </Find>
  </Object>
</Objects>
